<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
    Search: <input id="searchtxtbox" type="text" name="rootpath" value="C:\Private\01 Personal" style="width:40%">
    <button id="overviewbtn">Overview</button>
    <button id="cleanemptybtn">Clean Empty</button>
    <button id="cleanrubbishbtn">Clean Rubbish</button>
    <button id="findreplicates">Find replicates</button>
    <button id="compressbtn">Compress</button>
    <br>
    <table id="resulttb" style="width:100%"></table>
    <div id="btndiv" hidden>
        <button id="cleanupbtn">Confirm Clean-up</button>
    </div>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
    var currenttask = '';
    var currentdata = null;

    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    $('#overviewbtn').click(function() {
        $.get('http://localhost:3001/foldersize', { rootpath:$('#searchtxtbox').val() }, function(data) {
            var resulttb = $('#resulttb');
            resulttb.empty().append('<tr><th>Path</th><th>Size</th><th>Count</th></tr>');
            currentdata = JSON.parse(data).data;
            currentdata.forEach(function(element){
                resulttb.append('<tr><td>'+element.path+'</td><td>'+numberWithCommas(element.size)+'</td><td>'+element.count+'</td></tr>');
            });
            $('#btndiv').hide();
        });
    });

    $('#cleanemptybtn').click(function() {
        $.get('http://localhost:3001/cleanempty', { rootpath:$('#searchtxtbox').val() }, function(data) {
            var resulttb = $('#resulttb');
            resulttb.empty().append('<tr><th>Path</th><th>Is Directory</th></tr>');
            currentdata = JSON.parse(data).data;
            currentdata.forEach(function(element) {
                resulttb.append('<tr><td>'+element.path+'</td><td>'+element.isDirectory+'</td></tr>');
            });
            $('#btndiv').show();
            currenttask = 'cleanempty';
        });
    });

    $('#cleanrubbishbtn').click(function() {
        $.get('http://localhost:3001/cleanrubbish', {rootpath:$('#searchtxtbox').val()}, function(data) {
            var resulttb = $('#resulttb');
            resulttb.empty().append('<tr><th>Path</th><th>Is Directory</th></tr>');
            currentdata = JSON.parse(data).data;
            currentdata.forEach(function(element) {
                resulttb.append('<tr><td>'+element.path+'</td><td>'+element.isDirectory+'</td></tr>');
            });
            $('#btndiv').show();
            currenttask = 'cleanrubbish';
        });
    });

    $('#findreplicates').click(function() {
        $.get('http://localhost:3001/findreplicates', {rootpath:$('#searchtxtbox').val()}, function(data) {
            var resulttb = $('#resulttb');
            resulttb.empty();
            currentdata = JSON.parse(data).data;
            var idx = 0;
            currentdata.forEach(function(elem) {
                resulttb.append('<div>Duplicated files found, select to remove:  '+numberWithCommas(elem.filesize) + '<br>');
                elem.files.forEach(function(element) {
                    resulttb.append('<label><input type="radio" name="'+idx+'">'+element+'</label><br>');
                });
                resulttb.append('<br></div>');
                idx++;
            });
            $('#btndiv').show();
            currenttask = 'findreplicates';
        });
    });

    $('#compressbtn').click(function() {
        $.post('http://localhost:3001/compress', {data: JSON.stringify(currentdata) }, function(data) {

        });
    });

    function prepareforcleanup() {
        if(currenttask === 'findreplicates') {
            currentdata = [];
            $("input[type=radio]:checked").parent('label').each(function() {
                currentdata.push(this.textContent);
            });
        }
    }

    $('#cleanupbtn').click(function() {
        prepareforcleanup();
        $.post('http://localhost:3001/'+currenttask, { data: JSON.stringify(currentdata) }, function(data) {

        });
    });
    </script>
</body>
</html>